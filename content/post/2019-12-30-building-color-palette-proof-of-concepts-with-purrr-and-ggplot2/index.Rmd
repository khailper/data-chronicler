---
title: Building Color Palette Proof of Concepts with purrr and ggplot2
author: Karl Hailperin
date: '2019-12-30'
slug: []
categories: []
tags:
  - dataviz
description: ''
---
Recently, I raised the idea at work of changing the color palettes we use for 
our dashboards. I felt the default ones we using suffered from not being 
accessible to clients with color blindness and could also benefit from being more
distinctive. My boss was open to the idea, but (understandably) wanted me to put 
together mockups of possible new palettes before we starting tinkering with our
product. Fortunately the tidyverse makes it fast to generate proof of concepts 
for several palettes.

# Baseline plots
We want plots we can use to show off how different color palettes handle 
continuous and discrete data. A bar chart and a scatter plot seem like 
good ways to do that.

```{r setup, echo = FALSE}
library(tidyverse)
library(scico)
library(patchwork) # to put both plots in the same image

theme_set(theme_minimal())
```

```{r bar_chart}
bar_chart <- ggplot(diamonds, aes(cut, fill = cut)) + 
  geom_bar() + 
  coord_flip() +
  # fill guide would just duplicate x-axis label and take up space
  guides(fill = FALSE) +
  labs(x = "Cut", y = "# of diamonds")

bar_chart
```

```{r scatter_plot}
scatter_plot <- ggplot(txhousing, aes(listings, sales, color = median)) +
  geom_point() +
  labs(x = "Monthly listings in county", 
       y = "# of sales",
       color = "Median sale price")

scatter_plot
```

# Palettes
We're going to use a few palettes from
[`viridis`](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html) 
(now part of `ggplot2`) and 
[`scico`](https://www.data-imaginist.com/2018/scico-and-the-colour-conundrum/). 
Both packages prioritize palettes that are friendly to users with 
colorblindness and read well.Since this is for presenting to a higher-up, I've 
already narrowed itdown to two or three palettes from each package that I 
think might be appealing and are fairly different from each other.

```{r palettes}
viridis_palettes <- list(c("C", "plasma"), c("D", "viridis"))

scico_palettes <- c("devon", "lajolla", "lapaz")
```

We're using a list of vectors for `viridis`_pals` but not for `scico_pals` 
because `ggplot2` using letter codes to identify viridis palettes. However, we 
want to keep the name so that it can be used in plot titles and file names.
`scico` just uses the name of the palette, so a vector of palette names is 
enough.

# Creating the Proofs of Concept
Since we're repeating the same core process (building a pair of plots) with 
minor tweaks (using a different color palette), we should write a function
rather that we can re-run with a new parameter for each palette. Adding a 
palette from `viridis` is different enough from adding one from `scico` that 
we'll actually want two, one for each.
```{r build_vir_poc}
build_vir_poc <- function(vir_pal){

# use the letter code part of the vector for the scale function
vir_bar <- bar_chart + scale_fill_viridis_d(option = vir_pal[1])

vir_scatter <- scatter_plot + scale_color_viridis_c(option = vir_pal[1])

# use the name part for the title
vir_patch <-  vir_bar/ vir_scatter + 
  plot_annotation(title = vir_pal[2])

print(vir_patch)

# uncomment to include saving the files as part of the workflow
# ggsave(filename = here::here(paste0("figs/", vir_pal[2], ".jpg")),
#        plot = vir_patch)
}
```

```{r build_scico_poc}
build_scico_poc <- function(scico_pal){

scico_bar <- bar_chart + scale_fill_scico_d(palette = scico_pal)

scico_scatter <- scatter_plot + scale_color_scico(palette = scico_pal)
scico_patch <-  scico_bar/ scico_scatter + 
  plot_annotation(title = scico_pal)

print(scico_patch)

# uncomment to include saving the files as part of the workflow
# ggsave(filename = here::here(paste0("figs/", scico_pal, ".jpg")),
#        plot = scico_patch)
}
```

# Scale up with `purrr::walk()`
To generate all those plots, we need to iterate the functions over our palettes.
We could do this with a for loop, but we can simplify things with 
`purrr::walk()`. `walk` is  version of
(`purrr::map()`)[https://jennybc.github.io/purrr-tutorial/ls01_map-name-position-shortcuts.html] that is designed for functions where we care about the side effects (e.g. 
creating a plot, writing to a file) instead of a traditional return value (e.g. 
the square root of an input).
```{r create_plots}
walk(viridis_palettes, build_vir_poc)
walk(scico_palettes, build_scico_poc)
```

# Conclusion
