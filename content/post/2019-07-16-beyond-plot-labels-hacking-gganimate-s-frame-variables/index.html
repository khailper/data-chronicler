---
title: 'Beyond Plot Labels: Hacking gganimate''s Frame Variables'
author: Karl Hailperin
date: '2019-07-16'
slug: []
categories: []
tags:
  - gganimate
  - datavis
description: ''
---



<div id="an-introduction-to-frame-variables" class="section level1">
<h1>An introduction to frame variables</h1>
<p>One of <a href="https://cran.r-project.org/package=gganimate"><code>gganimate</code>’s</a> many cool
features is frame variables, which allow you to use data about the animation
in your labels. For example:</p>
<pre class="r"><code>library(tidyverse)
library(cowplot)
library(gganimate)</code></pre>
<pre class="r"><code>diamond_summary &lt;- diamonds %&gt;% 
  group_by(color, cut) %&gt;% 
  summarise(ave_price = mean(price), max_price = max(price))

ggplot(diamond_summary, aes(color, ave_price)) + 
  geom_col() +
  theme_minimal_hgrid() +
  transition_states(cut, transition_length = 3, state_length = 1) +
  ggtitle(&quot;Going from {previous_state} to {next_state}&quot;)</code></pre>
<p><img src="/post/2019-07-16-beyond-plot-labels-hacking-gganimate-s-frame-variables/index_files/figure-html/basic_frame_var-1.gif" /><!-- --></p>
<p>We can use <code>"{previous_state}"</code> to show that last value of <code>cut</code> we stopped
at and <code>"{next_state}"</code> to show where we’re going (Admittedly, it’s a little
awkward when they’re the same because we’re not in an in-between frame).</p>
<p>But what if we wanted a title like “Max price for [{next_state}] is [price] with
color: [color]”? Thankfully, {next_state} is a string we can pass to functions:</p>
<pre class="r"><code>ggplot(diamond_summary, aes(color, ave_price)) + 
  geom_col() +
  theme_minimal_hgrid() +
  transition_states(cut, transition_length = 3, state_length = 1) +
  ggtitle(&quot;next_state is a string: {is.character(next_state)}&quot;,
          subtitle = &quot;next_state is a factor: {is.factor(next_state)}&quot;)</code></pre>
<p><img src="/post/2019-07-16-beyond-plot-labels-hacking-gganimate-s-frame-variables/index_files/figure-html/proof-1.gif" /><!-- --></p>
<p>Note: Depending on the transition, type might be preserved instead of being
coerced to character. Experiment to figure out how the transition you’re using
handles the data before writing any functions.</p>
</div>
<div id="helper-functions-for-frame-variables" class="section level1">
<h1>Helper functions for frame variables</h1>
<p>So now we just need a pair of functions to find the which color has the highest
price for a given <code>next_state</code>.</p>
<pre class="r"><code>create_max_price_title &lt;- function(frame_var){
  max_price_row &lt;- diamond_summary %&gt;% 
    filter(cut == frame_var) %&gt;% 
    group_by(cut) %&gt;% 
    filter(max_price == max(max_price))
  
  max_price &lt;- pull(max_price_row, max_price)
  
  max_color &lt;- pull(max_price_row, color)
  
  paste( &quot;Max price for&quot;, frame_var,&quot;is&quot;, max_price, &quot;with color:&quot;, max_color)
}</code></pre>
<p>Now we’re good to go.</p>
<pre class="r"><code>ggplot(diamond_summary, aes(color, ave_price)) + 
  geom_col() +
  theme_minimal_hgrid() +
  transition_states(cut, transition_length = 3, state_length = 1) +
  ggtitle(&quot;{create_max_price_title(next_state)}&quot;)</code></pre>
<p><img src="/post/2019-07-16-beyond-plot-labels-hacking-gganimate-s-frame-variables/index_files/figure-html/anim_with_helper-1.gif" /><!-- --></p>
</div>
<div id="a-couple-of-notes-about-transition_reveal-and-transition_time" class="section level1">
<h1>A couple of notes about <code>transition_reveal()</code> and <code>transition_time()</code></h1>
<p>First, unlike <code>transition_state()</code>, both <code>transition_reveal()</code> and
<code>transition_time()</code> preserve the type of their frame variables. So, if your
helper function relies on the fact that you are transitioning over a date-time,
you don’t have to convert it back from a character.</p>
<p>On the other hand, the frame variables for <code>transition_reveal()</code> and
<code>transition_time()</code> don’t necessarily correspond to an actual value in your
data frame in the same way <code>next_state</code> does. <code>gganimate</code> creates artifical
times evenly spaced across your dataset and interpolates the appropiate values
for your other variables. The frame variables are those artifical times. So,
your helper function will need a step like
<code>filter(transition_col &lt;= frame_var)</code> instead of
<code>filter(transition_col == frame_var)</code>.</p>
</div>
